#!/usr/bin/perl
use strict;
use warnings;
use XML::LibXML;

# Joins the new OCR to the old ECO2 record, and converts the encoding to
# UTF8.

my $parser = XML::LibXML->new();
my $eco2 = $parser->parse_file(shift(@ARGV));
my $cihm = $eco2->findvalue('/eco2/@id');
$eco2->setEncoding('UTF-8');

foreach my $page ($eco2->findnodes('//pages/page')) {
    my $seq = $page->getAttribute('seq');
    my $ocr = $parser->parse_file("$cihm-$seq.xml");
    my ($words) = $ocr->findnodes('//Words');
    $eco2->adoptNode($words);
    $page->appendChild($words);
}


$eco2->toFile("eco2-$cihm.xml") or die("$!");
