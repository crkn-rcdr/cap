contributor ooe

<recordSet>
  record /add/doc
  skip   field[@name='type'][text() = 'resource']

  <fields>
    type        /add/doc[position()=%%]/field[@name='type']
    key         substring(/add/doc[position()=%%]/field[@name='key'], string-length(/add/doc[position()=%%]/field[@name='contributor']) + 2)
    label       /add/doc[position()=%%]/field[@name='label']
    clabel      /add/doc[position()=%%]/field[@name='clabel']
    pkey        substring(/add/doc[position()=%%]/field[@name='pkey'], string-length(/add/doc[position()=%%]/field[@name='contributor']) + 2)
    gkey        /add/doc[position()=%%]/field[@name='key']
    seq         /add/doc[position()=%%]/field[@name='seq']
    pubdate_min /add/doc[position()=%%]/field[@name='pubmin']
    pubdate_max /add/doc[position()=%%]/field[@name='pubmax']
    lang        /add/doc[position()=%%]/field[@name='lang']
    media       /add/doc[position()=%%]/field[@name='type']
    de          /add/doc[position()=%%]/field[@name='ctype']
    tx          /add/doc[position()=%%]/field[@name='tx_en' or @name='tx_fr']
    tx_lang     /add/doc[position()=%%]/field[@name='tx_en' or @name='tx_fr']/@name
    tx_type     /add/doc[position()=%%]/field[@name='tx_en' or @name='tx_fr']
    res_curi    concat("http://dfait-aeci.canadiana.ca/dfait/en/show/", /add/doc[position()=%%]/field[@name='key'])

    res_cmaster /add/doc/field[@name='type'][text() = 'resource']/following-sibling::field[@name='pkey'][text() = /add/doc[position()=%%]/field[@name='key']/text()]/following-sibling::field[@name='mime'][text() != 'application/pdf']/following-sibling::field[@name='file']
    res_cmaster_mime /add/doc/field[@name='type'][text() = 'resource']/following-sibling::field[@name='pkey'][text() = /add/doc[position()=%%]/field[@name='key']/text()]/following-sibling::field[@name='mime'][text() != 'application/pdf']
    res_cmaster_md5  /add/doc/field[@name='type'][text() = 'resource']/following-sibling::field[@name='pkey'][text() = /add/doc[position()=%%]/field[@name='key']/text()]/following-sibling::field[@name='mime'][text() != 'application/pdf']/following-sibling::field[@name='md5']
    res_cmaster_size /add/doc/field[@name='type'][text() = 'resource']/following-sibling::field[@name='pkey'][text() = /add/doc[position()=%%]/field[@name='key']/text()]/following-sibling::field[@name='mime'][text() != 'application/pdf']/following-sibling::field[@name='size']

    res_cdownload /add/doc/field[@name='type'][text() = 'resource']/following-sibling::field[@name='pkey'][text() = /add/doc[position()=%%]/field[@name='key']/text()]/following-sibling::field[@name='mime'][text() = 'application/pdf']/following-sibling::field[@name='file']
    res_cdownload_mime /add/doc/field[@name='type'][text() = 'resource']/following-sibling::field[@name='pkey'][text() = /add/doc[position()=%%]/field[@name='key']/text()]/following-sibling::field[@name='mime'][text() = 'application/pdf']
    res_cdownload_md5  /add/doc/field[@name='type'][text() = 'resource']/following-sibling::field[@name='pkey'][text() = /add/doc[position()=%%]/field[@name='key']/text()]/following-sibling::field[@name='mime'][text() = 'application/pdf']/following-sibling::field[@name='md5']
    res_cdownload_size /add/doc/field[@name='type'][text() = 'resource']/following-sibling::field[@name='pkey'][text() = /add/doc[position()=%%]/field[@name='key']/text()]/following-sibling::field[@name='mime'][text() = 'application/pdf']/following-sibling::field[@name='size']

  </fields>

  <filters>
    pkey        return 'StatementsAndSpeeches' unless ($_[0]);
    gkey        return 'StatementsAndSpeeches';
    pubdate_min $_[0] = iso8601($_[0], 0); $_[0] =~ s/-00-00/-01-01/; $_[0] =~ s/-00T/-01T/; $_[0] =~ s/-00-\d\dT/-01-01T/; return $_[0];
    pubdate_max $_[0] = iso8601($_[0], 1); $_[0] =~ s/-00-00/-12-31/; $_[0] =~ s/-00T/-28T/; $_[0] =~ s/-00-\d\dT/-12-31T/; return $_[0];
    lang        return 'fre' if ($_[0] eq 'fr'); return 'eng';
    media       return 'text';
    tx_lang     return 'fre' if ($_[0] eq 'tx_fr'); return 'eng';
    tx_type     return 'content';
    res_cmaster_md5 return substr($_[0], 0, 32);
    res_cmaster_mime $_[0] =~ s!image/tiffimage/tiff!image/tiff!; $_[0] =~ s!image/jpegimage/jpeg!image/jpeg!; return $_[0];
  </filters>
</recordSet>
