# DO NOT EDIT THIS FILE
#
# It is recommended that you do not edit this file. Site-specific
# information and custom changes should be placed in a file called
# cap_local.conf, which will override declarations made here.

# For Boolean values, you can use "1", "true", "yes", and "on"
# interchangeably. Likewise, you can use "0", "false", "no" and "off".

# Name of the Catalyst application.
name CAP

# The application root directory.
root = root

# Name of the default view to render.
default_view Default

# Version of the MySQL database to look for
db_version = 4

# Re-parse user data this many requests
init_interval 3

# An array of parameters to pass to the mailer. For standard SMTP, the
# first value should be 'SMTP' and the second the name of the mail host.
# These parameters should be sent in cap_local.conf instead of here. You
# cannot set them in both places and hope one overrides the latter.
#email = SMTP
#email = localhost

# A set of views that are available, in addition to the default view,
# 'json' and 'xml' (The latter two are built-in and the former is assumed
# to be present. View names are given an initial capital to map to a view
# module. I.e. "test" maps to "Test.pm".
<views>
  test = Test
  dojo = Dojo
  ajax = Ajax
</views>

# Set to true to enable some addtional profiling and debugging output both
# in the log files and on the templates. Set to false for production
# installations.
debug false

# MySQL database connection information.
<Component Model::DB>
    schema_class CAP::Schema
    <connect_info>
        dsn dbi:mysql:cap
        user cap
        password ""
    </connect_info>
</Component>

# The default portal to serve if the request base does not match something
# in the <portal> section below.
default_portal example

# Add base URLs to respond to portals other than the default (including
# the default is optional). The full <protocol>://<host>[<:port>]/ address
# must be specified.
<portals>
    http://localhost:3000/ = example
</portals>

# Default parameters. These should all be set to sensible values, or the
# application may behave strangely.
#<defaults>
#    image_size =  600 # default width (in pixels) for derivative images
#    image_min  =   50 # minimum size allowed for derivative images
#    image_max  = 1200 # maximum size allowed for derivative images
#</defaults>


# Advanced search configuration.
<adv>

  # Fields that can be specified using the adv_fl parameter. (See
  # <solr>/<fields> for allowed field names.
  <fields>
    au = on
    ti = on
    su = on
    q  = on
    contributor = on
  </fields>

  # The default field to search if adv_fl does not contain a valid field.
  default_field = q

</adv>


# Where we can find Solr
solr_url http://localhost:8983/solr/live/select

# Configure Solr defaults and search behaviour.
<solr>

  # Default Solr query parameters. These parameters will be used for every
  # query unless overridden by a particular function. If they are not
  # properly set, Solr may not function well or at all.
  <defaults>
    facet          = true
    facet.field    = lang
    facet.field    = media
    facet.field    = contributor
    facet.field    = set
    facet.limit    = -1
    facet.mincount = 1
    facet.sort     = true
    fl             = *
    rows           = 10
    sort           = score desc
    start          = 0
    wt             = json
    version        = 2.2
  </defaults>

  # Field query aliases get expanded into Solr query fragments. Each
  # instance of '%' will be replaced with the parameter value. Uppercase
  # versions of a field will be used when the query term is a quoted
  # string or phrase; otherwise, the lowercase field name is used.
  <fields>
    contributor = contributor:%
    key   = key:%
    lang  = lang:%
    media = media:%
    pkey  = pkey:%
    set   = set:%
    q     = au:% OR ti:% OR su:% OR no:% OR pu:% OR ab:% OR tx:%
    au    = au:%
    ti    = ti:%
    su    = su:% OR de:%
    tx    = tx:%
    no    = ab:% OR no:%
  </fields>

  # Fields that are marked as text fields will get some additional
  # transformations applied by Solr.pm during searches. Only fields that
  # are indexed as text (not literal strings) should be set here.
  <textfields>
    q  = on
    au = on
    ti = on
    su = on
    tx = on
    no = on
  </textfields>

  # The default field to search.
  default_field  = q

  # Map allowed values for the sort query parameter to the Solr sort
  # parameter.
  <sort>
   newest = pubmax desc
   oldest = pubmin asc
   seq    = pkey asc,seq asc
   score  = score desc
  </sort>

  # Map type searches to Solr query fragments.
  <type>
   any      = type:(series OR document OR page) 
   document = type:document
   series   = type:series
   page     = type:page
   default  = type:(document OR series)
  </type>

</solr>

# How to access the content server, and the expiry time to set for
# requests.
<content>
  url      = http://localhost/cos
  key      = 1
  password = default
  expires  = 3600
</content>

# Parameters for generating derivatives
<derivative>
  # Translate the s parameter into maximum image dimensions.
  default_size = 800x800
  <size>
    t = 100x100
    1 = 800x800
    2 = 1024x1024
    3 = 1296x1296
  </size>

  # Translate the r parameter into rotation (in degrees). The default is
  # no rotation.
  <rotate>
    0 = 0
    1 = 90
    2 = 180
    3 = 270
  </rotate>

</derivative>

# User information
<user>
    # Regular expressions defining requirements for each user field.
    # Username must be a valid email address.
    <fields>
        username = ^\S+@[\w\.]+$
        name     = \S
        password = ^\S{6,}$
    </fields>
</user>
