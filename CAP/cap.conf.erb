# cap.conf.erb
# This is the Ruby template file for the main CAP configuration file. To
# use locally (e.g. for testing) copy to cap.conf and edit to replace all
# of the variables with local values. You may also need to edit the
# <portal> section to enable local aliases for the non-default portals you
# want to run.

# For Boolean values, you can use "1", "true", "yes", and "on"
# interchangeably. Likewise, you can use "0", "false", "no" and "off".


# Name of the Catalyst application.
name CAP

# Application version information. This needs to be >=  to the value of
# $VERSION in CAP.pm or else the portal will not work.
version 0.62

# Name of the default view to render.
default_view Default

# Set to true to enable some addtional profiling and debugging output both
# in the log files and on the templates. Set to false for production
# installations.
debug <%= debug_var %>

# MySQL database connection information.
<Component Model::DB>
    schema_class CAP::Schema
    <connect_info>
        dsn dbi:mysql:cap
        user cap
        password ""
    </connect_info>
</Component>

# The default portal to serve if the request base does not match something
# in the <portal> section below.
default_portal co

# Add base URLs to respond to portals other than the default (including
# the default is optional). The full <protocol>://<host>[<:port>]/ address
# must be specified.
<portal>
    # Example: for local development/testing using the Catalyst server.
    # You may need to update /etc/hosts so that these resolve to 127.0.0.1
    #http://dfait.localhost:3000/ dfait
    #http://co.localhost:3000/ co

    # Live installations
    http://alpha.canadiana.ca/ co
    http://beta.canadiana.ca/ co
    http://dfait-aeci.canadiana.ca/ dfait
</portal>

# Path to the content repository (TIFF images, PDFs, etc.)
content <%= app_var %>/content

# Exec path to the netpbm programs.
netpbm_path /opt/cap-libs/netpbm/bin

# Default parameters. These should all be set to sensible values, or the
# application may behave strangely.
<defaults>
    image_size =  600 # default width (in pixels) for derivative images
    image_min  =   50 # minimum size allowed for derivative images
    image_max  = 1200 # maximum size allowed for derivative images
</defaults>

<solr>

  select_uri <%= select_uri %>
  update_uri <%= update_uri %>

  <defaults>
    version   2.2
    rows      10
    start     0
    score     score desc
    wt        json
    fl        *
  </defaults>

  # Fields to return for various search types
  <fl>
    ancestors key
    ancestors type
    ancestors label
    ancestors pkey
    ancestors gkey
    ancestors canonicalDownload
    ancestors canonicalDownloadMime
    ancestors canonicalDownloadSize
    ancestors canonicalDownloadMD5

    search key
    search type
    search contributor
    search label
    search pkey
    search gkey
    search seq
    search lang
    search media
    search canonicalUri
    search canonicalDownload
    search canonicalDownloadMime
    search canonicalDownloadSize
    search canonicalDownloadMD5
  </fl>

  # Field aliases mapping internal search field names to one or more Solr
  # field names.
  <fields>
    tx tx    # global text field
    tx tx_en # English text
    tx tx_fr # French text
    ti ti    # global title field
    ti ti_en # etc.
    ti ti_fr
    au au
    au au_en
    au au_fr
    su su
    su su_en
    su su_fr
    no no
    no no_en
    no no_fr
    kw kw
    kw kw_en
    kw kw_fr
    q  kw
    q  kw_en
    q  kw_fr
  </fields>

</solr>

# In addition to the default view, the following views are enabled. You
# can override these on a per-portal basis in the relevant portal.conf
# file. Note that 'xml' and 'json' have built-in handlers and are not
# handled by the view.
<fmt>
 xml  = on
 json = on
</fmt>

# Action paths that are enabled/disabled by default.
<action>
  /        = on
  search   = on
  show     = on
  static   = on
  get      = on
  download = on
  error    = off
  ajax/hello = off
</action>
