[%
  # component/navigation.tt - page/issue/sibling navigation - DFAIT version

  USE XML.Escape;

  # Determine the name of the PDF file
  IF response.item.doc.canonicalDownloadMime == 'application/pdf';
    pdf_file = response.item.doc.canonicalDownload;
    pdf_key = response.item.doc.key;
  ELSIF response.item.ancestors.first.canonicalDownloadMime == 'application/pdf';
    pdf_file = response.item.ancestors.first.canonicalDownload;
    pdf_key = response.item.ancestors.first.key;
  ELSE;
    pdf_file = "";
  END;
%]

<div id="nv" class="navigator">

  <div class="left">
  [% IF response.item.prev %]
    <a href="[% c.uri_for(root, 'show', response.item.prev.key) | xml_escape %]">
      <img class="widget" src="[% c.uri_for(root, 'static', 'widgets', 'prev.png') | xml_escape %]" alt="&lt;="/>
      [% response.item.prev.clabel | xml_escape %]
    </a>
  [% END %]
  &#160;
  </div>

  [% IF c.session.search %]
    <span>
       <a href="[% c.uri_for(root, 'search', c.session.search.start, c.session.search.params) | xml_escape %]">[% c.loc("Search results") | xml_escape %]</a>
     </span> |
  [% END %]

  [% IF pdf_file %]
    <span><a href="[% c.uri_for(root, 'download', pdf_key, pdf_file) | xml_escape %]">[% c.loc("Download PDF") | xml_escape %]</a></span> |
  [% END %]

  [%
    # If this document is part of a sequence, show its position relative
    # to its siblings of the same type.
  %]
  [% IF response.item.doc.type == 'page' %]
    <form method="post" action="[% c.uri_for(root, 'show', response.item.doc.key) | xml_escape %]">
      <div>
        <select name="rel">
        [% i = 1; WHILE i <= response.item.counts.siblings; %]
          <option value="[% i %]"[% IF i == response.item.position %] selected="selected"[% END %]>[% c.loc("Page [_1]", i) | xml_escape %]</option>
        [% i = i + 1; END %]
        </select>
        <button type="submit">[% c.loc("Show") %]</button>
      </div>
    </form>
  [% END %]

  [%-
    # If this item has pages, show a page menu
    # DEPRECATED - this code shouldn't run
  -%]
  [%- IF pages.size -%]
    <form method="post" action="[% c.uri_for(root, 'post') | xml_escape %]">
      <div>
        <input type="hidden" name="0" value="show"/>
        [% c.loc("Page") | xml_escape %]
        <select id="ui_select_page" name="1">
        [%- FOREACH page IN pages -%]
          [%- 
            IF page.key == doc.key;
              selected = ' selected="selected"';
            ELSE;
              selected = '';
            END;
          -%]
          <option value="[% page.key | xml_escape %]"[% selected %]>
          [% page.clabel | xml_escape %]
          </option>
        [%- END %]
        </select>
        <button id="ui_select_submit" type="submit">[% c.loc("Show") | xml_escape %]</button>
      </div>
    </form>
  [%- END -%]


  

  <div class="right">
  &#160;
  [%- IF response.item.next -%]
    <a href="[% c.uri_for(root, 'show', response.item.next.key) | xml_escape %]">
      [% response.item.next.clabel | xml_escape %]
      <img class="widget" src="[% c.uri_for(root, 'static', 'widgets', 'next.png') | xml_escape %]" alt="=&gt;"/>
    </a>
  [%- END -%]
  </div>

</div>
