<?xml version="1.0" encoding="UTF-8" ?>

<schema name="cap" version="1.1">

  <types>
    <fieldType name="string" class="solr.StrField" sortMissingLast="true" omitNorms="true"/>
    <fieldType name="sint" class="solr.SortableIntField" sortMissingLast="true" omitNorms="true"/>
    <fieldType name="date" class="solr.DateField" sortMissingLast="true" omitNorms="true"/>

    <fieldType name="text" class="solr.TextField" positionIncrementGap="100">
      <analyzer type="index">
        <tokenizer class="solr.WhitespaceTokenizerFactory"/>
        <filter class="solr.ISOLatin1AccentFilterFactory"/>
        <filter class="solr.WordDelimiterFilterFactory" generateWordParts="1" generateNumberParts="1" catenateWords="1" catenateNumbers="1" catenateAll="0" splitOnCaseChange="1"/>
        <filter class="solr.LowerCaseFilterFactory"/>
      </analyzer>
      <analyzer type="query">
        <tokenizer class="solr.WhitespaceTokenizerFactory"/>
        <filter class="solr.ISOLatin1AccentFilterFactory"/>
        <filter class="solr.WordDelimiterFilterFactory" generateWordParts="1" generateNumberParts="1" catenateWords="1" catenateNumbers="1" catenateAll="0" splitOnCaseChange="1"/>
        <filter class="solr.LowerCaseFilterFactory"/>
      </analyzer>
    </fieldType>

    <fieldType name="text_en" class="solr.TextField" positionIncrementGap="100">
      <analyzer type="index">
        <tokenizer class="solr.WhitespaceTokenizerFactory"/>
        <filter class="solr.ISOLatin1AccentFilterFactory"/>
        <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords-en.txt" enablePositionIncrements="true"/>
        <filter class="solr.WordDelimiterFilterFactory" generateWordParts="1" generateNumberParts="1" catenateWords="1" catenateNumbers="1" catenateAll="0" splitOnCaseChange="1"/>
        <filter class="solr.LowerCaseFilterFactory"/>
        <filter class="solr.SnowballPorterFilterFactory" language="English"/>
      </analyzer>
      <analyzer type="query">
        <tokenizer class="solr.WhitespaceTokenizerFactory"/>
        <filter class="solr.ISOLatin1AccentFilterFactory"/>
        <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords-en.txt" enablePositionIncrements="true"/>
        <filter class="solr.WordDelimiterFilterFactory" generateWordParts="1" generateNumberParts="1" catenateWords="1" catenateNumbers="1" catenateAll="0" splitOnCaseChange="1"/>
        <filter class="solr.LowerCaseFilterFactory"/>
        <filter class="solr.SnowballPorterFilterFactory" language="English"/>
      </analyzer>
    </fieldType>

    <fieldType name="text_fr" class="solr.TextField" positionIncrementGap="100">
      <analyzer type="index">
        <tokenizer class="solr.WhitespaceTokenizerFactory"/>
        <filter class="solr.ISOLatin1AccentFilterFactory"/>
        <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords-fr.txt" enablePositionIncrements="true"/>
        <filter class="solr.WordDelimiterFilterFactory" generateWordParts="1" generateNumberParts="1" catenateWords="1" catenateNumbers="1" catenateAll="0" splitOnCaseChange="1"/>
        <filter class="solr.LowerCaseFilterFactory"/>
        <filter class="solr.SnowballPorterFilterFactory" language="French"/>
      </analyzer>
      <analyzer type="query">
        <tokenizer class="solr.WhitespaceTokenizerFactory"/>
        <filter class="solr.ISOLatin1AccentFilterFactory"/>
        <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords-fr.txt" enablePositionIncrements="true"/>
        <filter class="solr.WordDelimiterFilterFactory" generateWordParts="1" generateNumberParts="1" catenateWords="1" catenateNumbers="1" catenateAll="0" splitOnCaseChange="1"/>
        <filter class="solr.LowerCaseFilterFactory"/>
        <filter class="solr.SnowballPorterFilterFactory" language="French"/>
      </analyzer>
    </fieldType>

  </types>

  <fields>

    <!-- Required control fields -->
    <field name="key" type="string" required="true" indexed="true" stored="true"/>
    <field name="type" type="string" required="true" indexed="true" stored="true"/>
    <field name="contributor" type="string" required="true" indexed="true" stored="true"/>
    <field name="label" type="string" required="true" indexed="true" stored="true"/>
    <field name="clabel" type="string" required="true" indexed="true" stored="true"/>
  
    <!-- Optional control fields -->
    <field name="pkey" type="string" indexed="true" stored="true"/>
    <field name="gkey" type="string" indexed="true" stored="true" multiValued="true"/>
    <field name="seq" type="sint" indexed="true" stored="true"/>
    <field name="pubmin" type="date" indexed="true" stored="true"/>
    <field name="pubmax" type="date" indexed="true" stored="true"/>
    <field name="lang" type="string" indexed="true" stored="true" multiValued="true"/>
    <field name="media" type="string" indexed="true" stored="true" multiValued="true"/>

    <!-- Description and content -->
    <field name="ti" type="text" indexed="true" stored="true" multiValued="true"/><!-- title -->
    <field name="au" type="text" indexed="true" stored="true" multiValued="true"/><!-- author/creator -->
    <field name="pu" type="text" indexed="true" stored="true" multiValued="true"/><!-- publication statement -->
    <field name="su" type="text" indexed="true" stored="true" multiValued="true"/><!-- subject -->
    <field name="no" type="text" indexed="true" stored="true" multiValued="true"/><!-- note -->
    <field name="de" type="text" indexed="true" stored="true" multiValued="true"/><!-- descriptor -->
    <field name="tx" type="text" indexed="true" stored="true" multiValued="true"/><!-- full text -->

    <!-- The preceding are duplicated for a keyword anywhere search -->
    <field name="kw" type="text" indexed="true" stored="false" multiValued="true"/>

    <!--
      These are meant to be used in conjunction with the preceding
      descriptive fields (including kw) to enable language-specific stemming
      and stopword filtering
    -->
    <dynamicField name="*_en" type="text_en" indexed="true" stored="false" multiValued="true"/>
    <dynamicField name="*_fr" type="text_fr" indexed="true" stored="false" multiValued="true"/>

    <!-- Canonical resource files and locations -->
    <field name="canonicalUri" type="text" indexed="true" stored="true" required="true"/>
    <field name="canonicalMaster" type="text" indexed="true" stored="true"/>
    <field name="canonicalMasterSize" type="sint" indexed="true" stored="true"/>
    <field name="canonicalMasterMime" type="text" indexed="true" stored="true"/>
    <field name="canonicalMasterMD5" type="text" indexed="true" stored="true"/>
    <field name="canonicalDownload" type="text" indexed="true" stored="true"/>
    <field name="canonicalDownloadSize" type="sint" indexed="true" stored="true"/>
    <field name="canonicalDownloadMime" type="text" indexed="true" stored="true"/>
    <field name="canonicalDownloadMD5" type="text" indexed="true" stored="true"/>

  </fields>

  <copyField source="ti_*" dest="ti"/>
  <copyField source="au_*" dest="au"/>
  <copyField source="pu_*" dest="pu"/>
  <copyField source="su_*" dest="su"/>
  <copyField source="no_*" dest="no"/>
  <copyField source="de_*" dest="no"/>
  <copyField source="tx_*" dest="tx"/>
  <copyField source="kw_*" dest="kw"/>

  <uniqueKey>key</uniqueKey>
  <defaultSearchField>tx</defaultSearchField>
  <solrQueryParser defaultOperator="AND"/>

</schema>
